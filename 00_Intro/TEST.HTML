<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>From Array Raw Data to PLINK Binary Format - GWAS Guide</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 5px;
            margin-top: 30px;
        }
        h3 {
            color: #2980b9;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
        code {
            background-color: #ecf0f1;
            padding: 2px 4px;
            border-radius: 3px;
            color: #c0392b;
        }
        pre {
            background-color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 20px 0;
            border: 1px solid #ccc;
            padding: 5px;
            border-radius: 5px;
        }
        .note {
            background-color: #fcf8e3;
            border: 1px solid #fbeed5;
            padding: 15px;
            border-radius: 4px;
            color: #8a6d3b;
            margin-bottom: 20px;
        }
        hr {
            border: 0;
            height: 1px;
            background-color: #bdc3c7;
            margin: 20px 0;
        }
    </style>
</head>
<body>

    <h1>GWAS Training Session</h1>
    <h2>Genome-Wide Association Study (GWAS) Training Session</h2>

    <p>This technical guide outlines the process of converting raw genetic data (Genotyping Arrays) into the optimised PLINK binary format, which is essential for performing efficient Genome-Wide Association Studies (GWAS).</p>

    <hr>

    <div class="note">
        <strong>NOTE ON FIGURES:</strong> To properly view this document, please replace the placeholder URLs in the image links (<code>YOUR_IMAGE_URL</code>) with the actual URLs of the figures extracted from the accompanying PowerPoint presentation.
    </div>

    <h2>1. Raw Array Data: The "Final Report File"</h2>

    <h3>Data Origin</h3>
    <p>Starting from a DNA sample, genotypes for 500,000 or more genetic variants are obtained. These variants are typically generated by genotyping arrays (e.g., Illumina Infinium Global Screening Array).</p>
    
    <img src="YOUR_IMAGE_URL_FOR_SLIDE_1_2" alt="Genotyping Array Illustration">

    <h3>Initial Representation</h3>
    <p>Genotypes are represented in a <strong>Final Report File</strong>.</p>
    <ul>
        <li>This is a text file with Comma Separated Values (<strong>.csv</strong>).</li>
        <li>It is produced after genotyping data analysis conducted with ad-hoc software (e.g., Genome Studio for Illumina machines).</li>
        <li>The file contains key information for each variant and sample, including the <strong>GenCall score (GC)</strong>, a confidence measure used to filter poor quality calls (Illumina generally recommends filtering genotypes with GC ≤ 0.15 as failures).</li>
    </ul>

    <img src="YOUR_IMAGE_URL_FOR_SLIDE_6_9" alt="Final Report File Example and GC Score Explanation">

    <h3>The Problem with the CSV Format</h3>
    <p>When working with hundreds of thousands of variants (e.g., 730,059 SNPs) and several individuals (N &gt; 500), the CSV format becomes unsustainable:</p>
    <ul>
        <li>Data is often split into multiple files (one per individual).</li>
        <li>The overall data size can reach Gigabytes (e.g., 4.5 GB for 730,059 SNPs x 130 samples).</li>
        <li><strong>Conclusion:</strong> This data is unusable in CSV format for performing a GWAS.</li>
    </ul>

    <hr>

    <h2>2. The Solution: The PLINK Binary Format</h2>

    <p>To perform statistical analysis, it is necessary to adopt binary formats, specifically the <strong>PLINK</strong> format.</p>
    <ul>
        <li><strong>PLINK</strong> is the most widely used software to date for GWAS and remains the <em>gold standard</em> for canonical GWAS studies run on lab servers.</li>
        <li>PLINK operates via the command line and requires files in the PLINK format. The standard and most efficient format is the binary file set of <strong><code>.bed</code>, <code>.bim</code>, and <code>.fam</code></strong>.</li>
    </ul>

    <h3>Description of the PLINK Binary File Set</h3>
    <table>
        <thead>
            <tr>
                <th>Extension</th>
                <th>File Name</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong><code>.bed</code></strong></td>
                <td>Binary Biallelic Genotype Table</td>
                <td>Primary representation of biallelic genotypes. It is a binary file, not directly readable, that must be interpreted with <code>.bim</code> and <code>.fam</code>.</td>
            </tr>
            <tr>
                <td><strong><code>.bim</code></strong></td>
                <td>Extended MAP File</td>
                <td>Text file (no header) with one row per variant and <strong>six fields</strong>.</td>
            </tr>
            <tr>
                <td><strong><code>.fam</code></strong></td>
                <td>Sample Information File</td>
                <td>Text file (no header) with one row per sample and <strong>six fields</strong>.</td>
            </tr>
        </tbody>
    </table>

    <img src="YOUR_IMAGE_URL_FOR_SLIDE_10_PLUS" alt="Diagram of the BED BIM FAM relationship">

    <h3>Field Details</h3>

    <h4>The <code>.bim</code> File (Variant Information)</h4>
    <ol>
        <li>Chromosome code (integer, X/Y/XY/MT).</li>
        <li>Variant identifier (SNP ID).</li>
        <li>Position in Morgans or Centimorgans (it is safe to use a dummy value of '0').</li>
        <li>Base-pair coordinate (1-based).</li>
        <li>Allele 1 (corresponds to clear bits in <code>.bed</code>, usually the minor allele).</li>
        <li>Allele 2 (corresponds to set bits in <code>.bed</code>, usually the major allele).</li>
    </ol>

    <h4>The <code>.fam</code> File (Sample/Phenotype Information)</h4>
    <ol>
        <li>Family ID (<code>FID</code>).</li>
        <li>Within-family ID (<code>IID</code>).</li>
        <li>IID of father ('0' if not present in the dataset).</li>
        <li>IID of mother ('0' if not present in the dataset).</li>
        <li>Sex code ('1' = male, '2' = female, '0' = unknown).</li>
        <li>Phenotype value ('1' = control, '2' = case, '-9'/'0'/non-numeric = missing data).</li>
    </ol>

    <hr>

    <h2>3. The PLINK Conversion Workflow</h2>

    <p>The conversion from the <strong>Final Report File</strong> (CSV) to the binary format (<code>.bed/.bim/.fam</code>) is not direct. The procedure goes through an intermediate text format, such as the <strong><code>.lgen</code></strong> format (PLINK long-format genotype file).</p>

    <img src="YOUR_IMAGE_URL_FOR_WORKFLOW_DIAGRAM" alt="Conversion Workflow Diagram (Final Report to Binary)">

    <h3>Conversion Phases</h3>
    <ol>
        <li><strong>From Final Report to <code>.lgen/.map/.fam</code></strong>:
            <p>All final report files are converted into the <code>.lgen</code> format. The <code>.lgen</code> file is readable by PLINK and combines information from <code>.map</code> (variants) and <code>.fam</code> (samples).</p>
        </li>
        <li><strong>From <code>.lgen/.map/.fam</code> to <code>.ped/.map</code> (Standard Text Format)</strong>:
            <p>The command <code>plink --lfile</code> is used to specify the input <code>.lgen/.map/.fam</code> files, and <code>--recode</code> is used to obtain the <code>.ped/.map</code> format.</p>
        </li>
        <li><strong>From <code>.ped/.map</code> to <code>.bed/.bim/.fam</code> (Final Binary Format)</strong>:
            <p>The command <code>plink --file</code> is used to specify the input <code>.ped/.map</code> files, and <code>--make-bed</code> is used to obtain the final binary format. The binary format is <strong>less time-consuming for analyses</strong>.</p>
        </li>
    </ol>

    <h3>PLINK Command Examples</h3>
    <p>The basic syntax of a PLINK command is: <code>plink --[source file command] [name] --[action command] --out [output name]</code>.</p>

    <table>
        <thead>
            <tr>
                <th>Function</th>
                <th>Command</th>
                <th>Output</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Convert to PED/MAP</strong></td>
                <td><code>plink --lfile ABC --recode --out ABC</code></td>
                <td><code>ABC.ped</code>, <code>ABC.map</code></td>
            </tr>
            <tr>
                <td><strong>Convert to Binary</strong></td>
                <td><code>plink --file ABC --make-bed --out ABC</code></td>
                <td><code>ABC.bed</code>, <code>ABC.bim</code>, <code>ABC.fam</code></td>
            </tr>
        </tbody>
    </table>

    <hr>
    
    <footer>
        <p><em>Source: Training School in Genomic data analysis in association studies. Pisa, Italy 19-21 June 2023. TRANSPAN COST action – University of PISA, Department of Biology.</em></p>
    </footer>

</body>
</html>
