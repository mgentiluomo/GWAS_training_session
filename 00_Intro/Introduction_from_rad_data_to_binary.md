# GWAS Training Session
## Genome-Wide Association Study (GWAS) Training Session

This technical guide outlines the process of converting raw genetic data (Genotyping Arrays) into the optimised PLINK binary format, which is essential for performing efficient Genome-Wide Association Studies (GWAS).

## 1. Raw Array Data: The "Final Report File"

### Data Origin
Starting from a DNA sample, genotypes for 500,000 or more genetic variants are obtained. These variants are typically generated by genotyping arrays (e.g., Illumina Infinium Global Screening Array).

![Genotyping Array Illustration](https://www.illumina.com/content/dam/illumina-marketing/images/product/clinical-research/global-screening-array.png)
<div align="center">
  [Genotyping Array Illustration](https://www.illumina.com/content/dam/illumina-marketing/images/product/clinical-research/global-screening-array.png)
  <p><em>Source: © 2025 Illumina, Inc. All rights reserved.</em></p>
</div>

![Genotyping Array Illustration](https://github.com/mgentiluomo/GWAS_training_session/blob/main/Figures/Genotyping%20array.png)


### Initial Representation
Genotypes are represented in a **Final Report File**.
* This is a text file with Comma Separated Values (**`.csv`**).
* It is produced after genotyping data analysis conducted with ad-hoc software (e.g., Genome Studio for Illumina machines).
* The file contains key information for each variant and sample, including the **GenCall score (GC)**, a confidence measure used to filter poor quality calls (Illumina generally recommends filtering genotypes with GC ≤ 0.15 as failures).
![Final Report File Example and GC Score Explanation](https://github.com/mgentiluomo/GWAS_training_session/blob/main/Figures/CSV_format.png)
<div align="center">
  
  <p><em>*The GenCall score (GC) is a confidence measure assigned to each call which can be used to filter poor quality calls, SNPs or samples. Illumina generally recommend that calls with GC ≤ 0.15 represent failed genotypes.

</em></p>
</div>


![Final Report](https://github.com/mgentiluomo/GWAS_training_session/blob/main/Figures/Final%20report%20file.png)
<div align="center">
  
  <p><em>Final report file.
</em></p>
</div>


### The Problem with the CSV Format
When working with hundreds of thousands of variants (e.g., 730,059 SNPs) and several individuals (N > 500), the CSV format becomes unsustainable:
* Data is often split into multiple files (one per individual).
* The overall data size can reach Gigabytes (e.g., 4.5 GB for 730,059 SNPs x 130 samples).
* **Conclusion:** This data is unusable in CSV format for performing a GWAS.

---

## 2. The Solution: The PLINK Binary Format

To perform statistical analysis, it is necessary to adopt binary formats, specifically the **PLINK** format.
* **PLINK** is the most widely used software to date for GWAS and remains the *gold standard* for canonical GWAS studies run on lab servers.
* PLINK operates via the command line and requires files in the PLINK format. The standard and most efficient format is the binary file set of **`.bed`, `.bim`, and `.fam`**.

### Description of the PLINK Binary File Set
| Extension | File Name | Description |
| :--- | :--- | :--- |
| **`.bed`** | Binary Biallelic Genotype Table | Primary representation of biallelic genotypes. It is a binary file, not directly readable, that must be interpreted with `.bim` and `.fam`. |
| **`.bim`** | Extended MAP File | Text file (no header) with one row per variant and **six fields**. |
| **`.fam`** | Sample Information File | Text file (no header) with one row per sample and **six fields**. |

<div align="center">
  ![Diagram of the BED BIM FAM relationship](YOUR_IMAGE_URL_FOR_SLIDE_10_PLUS)
  <p><em>Source: Training School in Genomic data analysis in association studies. Pisa, Italy 19-21 June 2023.</em></p>
</div>

### Field Details

#### The `.bim` File (Variant Information)
1. Chromosome code (integer, X/Y/XY/MT).
2. Variant identifier (SNP ID).
3. Position in Morgans or Centimorgans (it is safe to use a dummy value of '0').
4. Base-pair coordinate (1-based).
5. Allele 1 (corresponds to clear bits in `.bed`, usually the minor allele).
6. Allele 2 (corresponds to set bits in `.bed`, usually the major allele).

#### The `.fam` File (Sample/Phenotype Information)
1. Family ID (`FID`).
2. Within-family ID (`IID`).
3. IID of father ('0' if not present in the dataset).
4. IID of mother ('0' if not present in the dataset).
5. Sex code ('1' = male, '2' = female, '0' = unknown).
6. Phenotype value ('1' = control, '2' = case, '-9'/'0'/non-numeric = missing data).

---

## 3. The PLINK Conversion Workflow

The conversion from the **Final Report File** (CSV) to the binary format (`.bed/.bim/.fam`) is not direct. The procedure goes through an intermediate text format, such as the **`.lgen`** format (PLINK long-format genotype file).

<div align="center">
  ![Conversion Workflow Diagram (Final Report to Binary)](YOUR_IMAGE_URL_FOR_WORKFLOW_DIAGRAM)
  <p><em>Source: Training School in Genomic data analysis in association studies. Pisa, Italy 19-21 June 2023.</em></p>
</div>

### Conversion Phases
1. **From Final Report to `.lgen/.map/.fam`**:
    All final report files are converted into the `.lgen` format. The `.lgen` file is readable by PLINK and combines information from `.map` (variants) and `.fam` (samples).
2. **From `.lgen/.map/.fam` to `.ped/.map` (Standard Text Format)**:
    The command `plink --lfile` is used to specify the input `.lgen/.map/.fam` files, and `--recode` is used to obtain the `.ped/.map` format.
3. **From `.ped/.map` to `.bed/.bim/.fam` (Final Binary Format)**:
    The command `plink --file` is used to specify the input `.ped/.map` files, and `--make-bed` is used to obtain the final binary format. The binary format is **less time-consuming for analyses**.

### PLINK Command Examples
The basic syntax of a PLINK command is: `plink --[source file command] [name] --[action command] --out [output name]`.

| Function | Command | Output |
| :--- | :--- | :--- |
| **Convert to PED/MAP** | `plink --lfile ABC --recode --out ABC` | `ABC.ped`, `ABC.map` |
| **Convert to Binary** | `plink --file ABC --make-bed --out ABC` | `ABC.bed`, `ABC.bim`, `ABC.fam` |

---
*Source: Training School in Genomic data analysis in association studies. Pisa, Italy 19-21 June 2023. TRANSPAN COST action – University of PISA, Department of Biology.*
