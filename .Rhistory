View(BIM)
# Assign column names for better understanding.
names(BIM) <- c("Chr", "SNP", "cM", "Pos", "A1", "A2")
# Step 6: Investigate sex discrepancies
# Load the variant data related to sex discrepancies for detailed analysis.
QC2_sex_variants <- read.delim(paste(main, "02_QC/QC2_sex.hh", sep = ""), header = FALSE)
# Step 6: Quality Control (QC) - Check for sex discrepancies
# Run this section only if the .hh file exists
hh_file <- file.path(main, "02_QC/QC2_sex.hh")
if (file.exists(hh_file)) {
message("âœ… File found: running sex discrepancy QC steps...")
# Load the variant data related to sex discrepancies for detailed analysis.
QC2_sex_variants <- read.delim(hh_file, header = FALSE)
BIM <- read.delim(file.path(main, "02_QC/QC2_sex.bim"), header = FALSE)
# Assign column names for better understanding.
names(BIM) <- c("Chr", "SNP", "cM", "Pos", "A1", "A2")
names(QC2_sex_variants) <- c("FID", "IID", "SNP")
# Merge variant data with BIM file for additional information.
QC2_sex_variants <- merge(QC2_sex_variants, BIM, by = "SNP")
# Summary of chromosome distribution for problematic variants.
summary(as.factor(QC2_sex_variants$Chr))
# Step 7: Clean up sex discrepancies
# Set problematic variants to missing.
system(paste(plink_command,
"--bfile 02_QC/QC2_sex --set-hh-missing --make-bed --out 02_QC/QC2_sex_cleaned"))
message("âœ… QC2 sex discrepancy cleaning completed.")
} else {
message("âš ï¸ File 'QC2_sex.hh' not found â€” skipping sex discrepancy QC steps.")
}
# SECTION 2: Chromosome selection
# Retain only autosomal and sex chromosomes (1-23).
system(paste(plink_command, " --bfile 02_QC/QC2_sex --chr 1-23 --make-bed --out 02_QC/QC3_chr_selection"))
# SECTION 3: Minor Allele Frequency (MAF) filtering
# Exclude SNPs with a minor allele frequency (MAF) below 1%.
system(paste(plink_command, " --bfile 02_QC/QC3_chr_selection --maf 0.01 --write-snplist --make-bed --out 02_QC/QC4_maf"))
# SECTION 4: Call rate filtering
# Exclude SNPs with missing genotype data above 5%.
system(paste(plink_command, " --bfile 02_QC/QC4_maf --geno 0.05 --write-snplist --make-bed --out 02_QC/QC5_geno"))
# Exclude individuals with missing genotype data above 10%.
system(paste(plink_command, " --bfile 02_QC/QC5_geno --mind 0.10 --make-bed --out 02_QC/QC6_mind"))
# SECTION 5: Heterozygosity check
# Calculate heterozygosity rates for each individual.
system(paste(plink_command, " --bfile 02_QC/QC6_mind --het --out 02_QC/heterozygosity"))
# Load heterozygosity data and identify outliers (Â±3 SD from the mean).
dat <- read.table(paste(QC_dir, "heterozygosity.het", sep = ""), header = TRUE)
m <- mean(dat$F)
s <- sd(dat$F)
valid <- subset(dat, F <= m + 3 * s & F >= m - 3 * s)
# Save the list of valid individuals.
write.table(valid[, c("FID", "IID")], paste(QC_dir, "DB_valid_sample.txt", sep = ""), quote = FALSE, row.names = FALSE)
valid <- subset(dat, F <= m + 3 * s & F >= m - 3 * s)
View(valid)
View(dat)
heterozygosity <- read.delim("F:/OneDrive - University of Pisa/Desktop/Class_folder/02_QC/heterozygosity.het", quote="")
View(heterozygosity)
# Load heterozygosity data and identify outliers (Â±3 SD from the mean).
dat <- read.delim(paste(QC_dir, "heterozygosity.het", sep = ""), header = TRUE, quote="")
View(dat)
# Load heterozygosity data and identify outliers (Â±3 SD from the mean).
dat <- read.delim(paste(QC_dir, "heterozygosity.het", sep = ""), header = TRUE, quote="")
dat <- read.delim(paste(QC_dir, "heterozygosity.het", sep = ""), header = TRUE, quote="")
dat <- dat %>%
rename(FID = `#FID`)
View(dat)
dat <- dat %>%
rename(FID = `X.FID`)
View(dat)
# Load heterozygosity data and identify outliers (Â±3 SD from the mean).
dat <- read.delim(paste(QC_dir, "heterozygosity.het", sep = ""), header = TRUE, quote="")
dat <- dat %>%
rename(FID = `X.FID`)
m <- mean(dat$F)
s <- sd(dat$F)
valid <- subset(dat, F <= m + 3 * s & F >= m - 3 * s)
# Save the list of valid individuals.
write.table(valid[, c("FID", "IID")], paste(QC_dir, "DB_valid_sample.txt", sep = ""), quote = FALSE, row.names = FALSE)
# Retain only individuals with acceptable heterozygosity.
system(paste(plink_command, " --bfile 02_QC/QC6_mind --keep 02_QC/DB_valid_sample.txt --make-bed --out 02_QC/QC7_het"))
View(valid)
# SECTION 6: Cryptic relatedness check
# Step 1: Prune SNPs for relatedness analysis.
system(paste(plink_command, " --bfile 02_QC/QC7_het --indep-pairwise 200 50 0.25 --out 02_QC/Pruned_list"))
# Step 2: Identify and exclude related individuals (threshold: 0.2).
system(paste(plink_command, " --bfile 02_QC/QC7_het --extract 02_QC/Pruned_list.prune.in --rel-cutoff 0.2 --out 02_QC/subject_rel"))
# qc_rel_cutoff_plink2
# Step 2: Identify and exclude related individuals using KING-based cutoff (PLINK 2).
# We restrict to the pruned SNPs to avoid LD inflation.
# Threshold 0.2 ~ between 1st and 2nd degree; adjust to your protocol.
system(paste(
plink_command,
"--bfile 02_QC/QC7_het",
"--extract 02_QC/Pruned_list.prune.in",
"--king-cutoff 0.2",
"--out 02_QC/subject_rel"
))
# PLINK 2 writes:
#   02_QC/subject_rel.king.cutoff.in.id   -> samples to KEEP
#   02_QC/subject_rel.king.cutoff.out.id  -> samples to REMOVE
# qc_make_unrelated_dataset_plink2
# Step 3 (Option A): Keep only unrelated samples (recommended).
system(paste(
plink_command,
"--bfile 02_QC/QC7_het",
"--keep 02_QC/subject_rel.king.cutoff.in.id",
"--make-bed",
"--out 02_QC/QC8_rel"
))
# (Option B): Alternatively, remove the related samples.
# system(paste(
#   plink_command,
#   "--bfile 02_QC/QC7_het",
#   "--remove 02_QC/subject_rel.king.cutoff.out.id",
#   "--make-bed",
#   "--out 02_QC/QC8_rel"
# ))
#3.f - QC show related pairs above cutoff
# qc_show_related_pairs
# Step 2b: Display pairs of related individuals with kinship above the cutoff.
# Load KING output table with pairwise kinship estimates
king_file <- "02_QC/subject_rel.king.cutoff.out.id"
if (file.exists(king_file)) {
message("âœ… Displaying pairs of related individuals above the cutoff threshold:")
# The KING output file usually contains pairs of IDs and kinship coefficients
# Example expected columns: ID1, ID2, Kinship
king_pairs <- read.table("02_QC/subject_rel.king", header = TRUE)
# Filter pairs above the same cutoff used (e.g., 0.2)
related_pairs <- subset(king_pairs, Kinship > 0.2)
# Show first few lines for a quick overview
head(related_pairs)
# Optional: summary of degree distribution
summary(related_pairs$Kinship)
} else {
message("âš ï¸ No KING table found â€” make sure you ran the kinship estimation before this step.")
}
# qc_rel_cutoff_plink2
# Step 2: Identify and exclude related individuals using KING-based cutoff (PLINK 2).
# We restrict to the pruned SNPs to avoid LD inflation.
# Threshold 0.2 ~ between 1st and 2nd degree; adjust to your protocol.
system(paste(
plink_command,
"--bfile 02_QC/QC7_het",
"--extract 02_QC/Pruned_list.prune.in",
"--king-cutoff 0.2",
"--out 02_QC/subject_rel"
))
# PLINK 2 writes:
#   02_QC/subject_rel.king.cutoff.in.id   -> samples to KEEP
#   02_QC/subject_rel.king.cutoff.out.id  -> samples to REMOVE
```{r #3.f - QC show related pairs above cutoff}
#3.f - QC show related pairs above cutoff
# qc_show_related_pairs_plink2
# Step 2b: Create the KING table and display pairs with kinship above the cutoff.
cutoff <- 0.2  # keep this aligned with the --king-cutoff used above
# 1) Generate the KING pairwise table (this writes 02_QC/subject_rel_pairs.king)
system(paste(
plink_command,
"--bfile 02_QC/QC7_het",
"--extract 02_QC/Pruned_list.prune.in",
"--make-king-table",
"--out 02_QC/subject_rel_pairs"
))
# 2) Load the KING table and filter by the chosen cutoff
pairs_file <- "02_QC/subject_rel_pairs.king"
if (file.exists(pairs_file)) {
# Read the table; PLINK 2 typically provides a header with Kinship column.
king_pairs <- read.table(pairs_file, header = TRUE, sep = "", stringsAsFactors = FALSE, check.names = FALSE)
# Be robust to column naming: prefer 'Kinship' if present, otherwise use the 5th column.
kin_col <- if ("Kinship" %in% names(king_pairs)) "Kinship" else names(king_pairs)[5]
related_pairs <- subset(king_pairs, king_pairs[[kin_col]] > cutoff)
message("âœ… Pairs above cutoff (kinship > ", cutoff, "):")
print(utils::head(related_pairs, 20))  # show first 20 for a quick glance
# Optional: save the filtered pairs to a TSV for auditing
out_tsv <- "02_QC/subject_rel_pairs.above_cutoff.tsv"
write.table(related_pairs, out_tsv, sep = "\t", row.names = FALSE, quote = FALSE)
message("Saved filtered pairs to: ", out_tsv)
} else {
message("âš ï¸ KING table not found at ", pairs_file, ". Please check the previous step.")
}
#3.f - QC show related pairs above cutoff
# qc_show_related_pairs_plink2
# Step 2b: Create the KING table and display pairs with kinship above the cutoff.
cutoff <- 0.2  # keep this aligned with the --king-cutoff used above
# 1) Generate the KING pairwise table (this writes 02_QC/subject_rel_pairs.king)
system(paste(
plink_command,
"--bfile 02_QC/QC7_het",
"--extract 02_QC/Pruned_list.prune.in",
"--make-king-table",
"--out 02_QC/subject_rel_pairs"
))
# 2) Load the KING table and filter by the chosen cutoff
pairs_file <- "02_QC/subject_rel_pairs.king"
if (file.exists(pairs_file)) {
# Read the table; PLINK 2 typically provides a header with Kinship column.
king_pairs <- read.table(pairs_file, header = TRUE, sep = "", stringsAsFactors = FALSE, check.names = FALSE)
# Be robust to column naming: prefer 'Kinship' if present, otherwise use the 5th column.
kin_col <- if ("Kinship" %in% names(king_pairs)) "Kinship" else names(king_pairs)[5]
related_pairs <- subset(king_pairs, king_pairs[[kin_col]] > cutoff)
message("âœ… Pairs above cutoff (kinship > ", cutoff, "):")
print(utils::head(related_pairs, 20))  # show first 20 for a quick glance
# Optional: save the filtered pairs to a TSV for auditing
out_tsv <- "02_QC/subject_rel_pairs.above_cutoff.tsv"
write.table(related_pairs, out_tsv, sep = "\t", row.names = FALSE, quote = FALSE)
message("Saved filtered pairs to: ", out_tsv)
} else {
message("âš ï¸ KING table not found at ", pairs_file, ". Please check the previous step.")
}
#3.f - QC show related pairs above cutoff}
# qc_show_related_pairs_plink2 (fixed filenames)
# Step 2b: Display pairs of related individuals with kinship above the cutoff.
cutoff <- 0.2  # keep aligned with the --king-cutoff used above
# Expected KING output from PLINK 2:
kin_plain <- "02_QC/subject_rel_pairs.kin0"
kin_gz    <- "02_QC/subject_rel_pairs.kin0.gz"
# Choose the file that exists
kin_file <- if (file.exists(kin_plain)) kin_plain else if (file.exists(kin_gz)) kin_gz else NA
if (!is.na(kin_file)) {
message("âœ… Reading KING table: ", kin_file)
# Read .kin0 (supports gz if present)
con <- if (endsWith(kin_file, ".gz")) gzfile(kin_file, open = "rt") else file(kin_file, open = "r")
on.exit(close(con), add = TRUE)
king_pairs <- read.table(con, header = TRUE, sep = "", stringsAsFactors = FALSE, check.names = FALSE)
# Be robust to column naming (typical columns include: FID1, ID1, FID2, ID2, NSNP, HetHet, IBS0, Kinship)
kin_col <- if ("Kinship" %in% names(king_pairs)) {
"Kinship"
} else if ("KINSHIP" %in% names(king_pairs)) {
"KINSHIP"
} else {
# fallback: try last column
tail(names(king_pairs), 1)
}
# Filter pairs above cutoff
related_pairs <- subset(king_pairs, king_pairs[[kin_col]] > cutoff)
message("Pairs above cutoff (kinship > ", cutoff, "): ", nrow(related_pairs))
print(utils::head(related_pairs, 20))  # quick glance
# Save filtered pairs for auditing
out_tsv <- "02_QC/subject_rel_pairs.above_cutoff.tsv"
write.table(related_pairs, out_tsv, sep = "\t", row.names = FALSE, quote = FALSE)
message("Saved filtered pairs to: ", out_tsv)
} else {
message("âš ï¸ KING table not found: expected 02_QC/subject_rel_pairs.kin0 (or .kin0.gz).")
}
View(king_pairs)
head(king_pairs)
#3.f - QC show related pairs above cutoff}
# qc_show_related_pairs_plink2 (with proper column headers)
# Step 2b: Display pairs of related individuals with kinship above the cutoff.
cutoff <- 0.2  # keep aligned with the --king-cutoff used above
# Expected KING output from PLINK 2:
kin_plain <- "02_QC/subject_rel_pairs.kin0"
kin_gz    <- "02_QC/subject_rel_pairs.kin0.gz"
kin_file  <- if (file.exists(kin_plain)) kin_plain else if (file.exists(kin_gz)) kin_gz else NA
if (!is.na(kin_file)) {
message("âœ… Reading KING table: ", kin_file)
# Read file (with or without header)
con <- if (endsWith(kin_file, ".gz")) gzfile(kin_file, open = "rt") else file(kin_file, open = "r")
on.exit(close(con), add = TRUE)
king_pairs <- read.table(con, header = FALSE, sep = "", stringsAsFactors = FALSE)
# Assign proper PLINK 2 KING column names
names(king_pairs) <- c("FID1", "IID1", "FID2", "IID2", "NSNP", "HetHet", "IBS0", "Kinship")
# Filter pairs above cutoff
related_pairs <- subset(king_pairs, Kinship > cutoff)
message("Pairs above cutoff (kinship > ", cutoff, "): ", nrow(related_pairs))
print(utils::head(related_pairs, 20))
# Save filtered pairs
out_tsv <- "02_QC/subject_rel_pairs.above_cutoff.tsv"
write.table(related_pairs, out_tsv, sep = "\t", row.names = FALSE, quote = FALSE)
message("Saved filtered pairs to: ", out_tsv)
} else {
message("âš ï¸ KING table not found: expected 02_QC/subject_rel_pairs.kin0 (or .kin0.gz).")
}
View(king_pairs)
View(related_pairs)
# qc_make_unrelated_dataset_plink2
# Step 3 (Option A): Keep only unrelated samples (recommended).
system(paste(
plink_command,
"--bfile 02_QC/QC7_het",
"--keep 02_QC/subject_rel.king.cutoff.in.id",
"--make-bed",
"--out 02_QC/QC8_rel"
))
# (Option B): Alternatively, remove the related samples.
# system(paste(
#   plink_command,
#   "--bfile 02_QC/QC7_het",
#   "--remove 02_QC/subject_rel.king.cutoff.out.id",
#   "--make-bed",
#   "--out 02_QC/QC8_rel"
# ))
# SECTION 7: Hardy-Weinberg equilibrium filtering
# Filter SNPs failing the Hardy-Weinberg equilibrium test (p-value < 1e-5).
system(paste(plink_command, " --bfile 02_QC/QC8_rel --hwe 1e-5 --pheno 01_Database/pheno.txt --write-snplist --make-bed --out 02_QC/QC9_hwe"))
# SECTION 8: Save environment
# Save the R environment for backup and reproducibility.
save.image(paste(main, "Env_chunk3.RData", sep = ""))
# Confirm completion of the chunk.
print("End of chunk 3")
# End of chunk 3
# SECTION 8: Save environment
# Save the R environment for backup and reproducibility.
save.image(paste(main, "Env_chunk_QC.RData", sep = ""))
# Confirm completion of the chunk.
print("End of chunk 3")
# End of chunk 3
# Step 1.b.3 â€” Download input files into 01_Database
# Define the target directory
DB_dir <- file.path(main, "01_Database")
# Define URLs (raw GitHub links)
files_to_download <- list(
sex   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Sex.txt",
covar = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/general_covar.txt",
pheno = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/pheno.txt",
bim   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.bim",
fam   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.fam"
)
# Loop to download each file
for (name in names(files_to_download)) {
dest_file <- file.path(DB_dir, basename(files_to_download[[name]]))
# Download file if it doesn't already exist
if (!file.exists(dest_file)) {
message("â¬‡ï¸ Downloading ", name, " file...")
download.file(files_to_download[[name]], destfile = dest_file, mode = "wb")
} else {
message("âœ… File already exists: ", basename(dest_file))
}
}
# Confirm that files are present
cat("ðŸ“‚ Files now available in:", DB_dir, "\n")
print(list.files(DB_dir, pattern = "txt$|bim$|fam$", full.names = TRUE))
# Step 1.b.3 â€” Download input files into 01_Database
# Define the target directory
DB_dir <- file.path(main, "01_Database")
# Define URLs (raw GitHub links)
files_to_download <- list(
sex   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Sex.txt",
covar = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/general_covar.txt",
pheno = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/pheno.txt",
bim   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.bim",
fam   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.fam",
linktobed ="https://github.com/mgentiluomo/GWAS_training_session/blob/main/02_Database/Databases/link_to_BED_file"
)
# Loop to download each file
for (name in names(files_to_download)) {
dest_file <- file.path(DB_dir, basename(files_to_download[[name]]))
# Download file if it doesn't already exist
if (!file.exists(dest_file)) {
message("â¬‡ï¸ Downloading ", name, " file...")
download.file(files_to_download[[name]], destfile = dest_file, mode = "wb")
} else {
message("âœ… File already exists: ", basename(dest_file))
}
}
# Confirm that files are present
cat("ðŸ“‚ Files now available in:", DB_dir, "\n")
print(list.files(DB_dir, pattern = "txt$|bim$|fam$", full.names = TRUE))
# Step 1.b.3 â€” Download input files into 01_Database
# Define the target directory
DB_dir <- file.path(main, "01_Database")
# Define URLs (raw GitHub links)
files_to_download <- list(
sex   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Sex.txt",
covar = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/general_covar.txt",
pheno = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/pheno.txt",
bim   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.bim",
fam   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.fam",
linktobed ="https://github.com/mgentiluomo/GWAS_training_session/blob/main/02_Database/Databases/link_to_BED_file.txt"
)
# Loop to download each file
for (name in names(files_to_download)) {
dest_file <- file.path(DB_dir, basename(files_to_download[[name]]))
# Download file if it doesn't already exist
if (!file.exists(dest_file)) {
message("â¬‡ï¸ Downloading ", name, " file...")
download.file(files_to_download[[name]], destfile = dest_file, mode = "wb")
} else {
message("âœ… File already exists: ", basename(dest_file))
}
}
# Confirm that files are present
cat("ðŸ“‚ Files now available in:", DB_dir, "\n")
print(list.files(DB_dir, pattern = "txt$|bim$|fam$", full.names = TRUE))
# Step 1.b.3 â€” Download input files into 01_Database
# Define the target directory
DB_dir <- file.path(main, "01_Database")
# Define URLs (raw GitHub links)
files_to_download <- list(
sex   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Sex.txt",
covar = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/general_covar.txt",
pheno = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/pheno.txt",
bim   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.bim",
fam   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.fam",
linktobed ="https://github.com/mgentiluomo/GWAS_training_session/blob/main/02_Database/Databases/link_to_BED_file.txt"
)
# Loop to download each file
for (name in names(files_to_download)) {
dest_file <- file.path(DB_dir, basename(files_to_download[[name]]))
# Download file if it doesn't already exist
if (!file.exists(dest_file)) {
message("â¬‡ï¸ Downloading ", name, " file...")
download.file(files_to_download[[name]], destfile = dest_file, mode = "wb")
} else {
message("âœ… File already exists: ", basename(dest_file))
}
}
# Confirm that files are present
cat("ðŸ“‚ Files now available in:", DB_dir, "\n")
print(list.files(DB_dir, pattern = "txt$|bim$|fam$", full.names = TRUE))
# Step 1.b.3 â€” Download input files into 01_Database
# Define the target directory
DB_dir <- file.path(main, "01_Database")
# Define URLs (raw GitHub links)
files_to_download <- list(
sex   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Sex.txt",
covar = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/general_covar.txt",
pheno = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/pheno.txt",
bim   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.bim",
fam   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.fam",
linktobed ="https://github.com/mgentiluomo/GWAS_training_session/blob/main/02_Database/Databases/link_to_BED_file.txt"
)
# Loop to download each file
for (name in names(files_to_download)) {
dest_file <- file.path(DB_dir, basename(files_to_download[[name]]))
# Download file if it doesn't already exist
if (!file.exists(dest_file)) {
message("â¬‡ï¸ Downloading ", name, " file...")
download.file(files_to_download[[name]], destfile = dest_file, mode = "wb")
} else {
message("âœ… File already exists: ", basename(dest_file))
}
}
# Confirm that files are present
cat("ðŸ“‚ Files now available in:", DB_dir, "\n")
print(list.files(DB_dir, pattern = "txt$|bim$|fam$", full.names = TRUE))
# Step 1.b.3 â€” Download input files into 01_Database
# Define the target directory
DB_dir <- file.path(main, "01_Database")
# Define URLs (raw GitHub links)
files_to_download <- list(
sex   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Sex.txt",
covar = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/general_covar.txt",
pheno = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/pheno.txt",
bim   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.bim",
fam   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.fam",
linktobed ="https://github.com/mgentiluomo/GWAS_training_session/blob/main/02_Database/link_to_BED_file.txt"
)
# Loop to download each file
for (name in names(files_to_download)) {
dest_file <- file.path(DB_dir, basename(files_to_download[[name]]))
# Download file if it doesn't already exist
if (!file.exists(dest_file)) {
message("â¬‡ï¸ Downloading ", name, " file...")
download.file(files_to_download[[name]], destfile = dest_file, mode = "wb")
} else {
message("âœ… File already exists: ", basename(dest_file))
}
}
# Confirm that files are present
cat("ðŸ“‚ Files now available in:", DB_dir, "\n")
print(list.files(DB_dir, pattern = "txt$|bim$|fam$", full.names = TRUE))
# Step 1.b.3 â€” Download input files into 01_Database
# Define the target directory
DB_dir <- file.path(main, "01_Database")
# Define URLs (raw GitHub links)
files_to_download <- list(
sex   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Sex.txt",
covar = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/general_covar.txt",
pheno = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/pheno.txt",
bim   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.bim",
fam   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.fam",
linktobed ="https://github.com/mgentiluomo/GWAS_training_session/blob/main/02_Database/link_to_BED_file.txt"
)
# Loop to download each file
for (name in names(files_to_download)) {
dest_file <- file.path(DB_dir, basename(files_to_download[[name]]))
# Download file if it doesn't already exist
if (!file.exists(dest_file)) {
message("â¬‡ï¸ Downloading ", name, " file...")
download.file(files_to_download[[name]], destfile = dest_file, mode = "wb")
} else {
message("âœ… File already exists: ", basename(dest_file))
}
}
# Confirm that files are present
cat("ðŸ“‚ Files now available in:", DB_dir, "\n")
print(list.files(DB_dir, pattern = "txt$|bim$|fam$", full.names = TRUE))
# Step 1.b.3 â€” Download input files into 01_Database
# Define the target directory
DB_dir <- file.path(main, "01_Database")
# Define URLs (raw GitHub links)
files_to_download <- list(
sex   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Sex.txt",
covar = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/general_covar.txt",
pheno = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/pheno.txt",
bim   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.bim",
fam   = "https://raw.githubusercontent.com/mgentiluomo/GWAS_training_session/main/02_Database/Databases/DB_A.fam",
linktobed ="https://github.com/mgentiluomo/GWAS_training_session/blob/main/02_Database/Databases/linktoBEDfile.txt"
)
# Loop to download each file
for (name in names(files_to_download)) {
dest_file <- file.path(DB_dir, basename(files_to_download[[name]]))
# Download file if it doesn't already exist
if (!file.exists(dest_file)) {
message("â¬‡ï¸ Downloading ", name, " file...")
download.file(files_to_download[[name]], destfile = dest_file, mode = "wb")
} else {
message("âœ… File already exists: ", basename(dest_file))
}
}
# Confirm that files are present
cat("ðŸ“‚ Files now available in:", DB_dir, "\n")
print(list.files(DB_dir, pattern = "txt$|bim$|fam$", full.names = TRUE))
